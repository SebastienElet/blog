<!--VarStream
title=Récupérer les privilèges de l'utilisateur root de MySQL
description=En administration système, tout arrive, même les cas les plus désespérés. Perdre le mot de passe ou les privilèges de root de MySQL en fait partie. Voici comment s'en sortir.
shortTitle=Privilèges root perdus ?
shortDesc=Voir la méthode
published=2012-05-19T13:02:39.000Z
lang=fr
location=FR
keywords.+=JavaScript
categories.+=.*
-->

<h2>En administration système, tout arrive, même les cas les plus désespérés. Perdre le mot de passe ou les privilèges de root de MySQL en fait partie. Voici comment s'en sortir.</h2>
<p>En administration système, tout arrive, même les cas les plus désespérés. Perdre
  le mot de passe ou les privilèges de root de MySQL en fait partie. Voici comment
  s'en sortir.</p>

<p>Perdre les privilèges et/ou le mot de passe de l'utilisateur root de MySQL est plutôt
  ennuyeux. Pour résoudre ce problème, il va falloir utiliser la ligne de commande.
  Sous Debian GNU/Linux, la méthode est la suivante.</p>
<p>Tout d'abord, il faut arrêter le serveur MySQL :</p><pre>root@server:~# /etc/init.d/mysql stop</pre>
<p>Si le serveur ne s'arrête pas, il faut alors trouver le numéro de processus du démon
  MySQL (PID) :</p><pre>root@server:~# ps aux | grep mysqld<br />mysql 27257 0.0 7.0 136720 17824 pts/1 Sl 15:30 0:00 /usr/sbin/mysqld --basedir=/usr --datadir=/var/lib/mysql --user=mysql --pid-file=/var/run/mysqld/mysqld.pid --socket=/var/run/mysqld/mysqld.sock --port=3306<br />root 27341 0.0 0.3 3320 804 pts/1 S+ 15:37 0:00 grep mysqld</pre>
<p>Puis, l'arrêter manuellement (ici, il s'agit du PID 27257) :</p><pre>root@server:~# kill 27257</pre>
<p>Maintenant, nous allons démarrer le démon MySQL en ligne de commande en lui ajoutant
  des options bien pratiques. Tout d'abord l'option --skip-grant-tables qui permet
  d'enlever les vérifications de privilège et d'accéder sans authentification au
  serveur MySQL. Ensuite, l'option --skip-networking afin d'éviter d'exposer le serveur
  au réseau ce qui pourrait laisser la porte ouverte au hacker avisé qui passerai
  par là.</p><pre>root@server:~# mysqld --skip-grant-tables --skip-networking &</pre>
<p>L'esperluette permet de récupérer la ligne de commande après le démarrage du démon
  car nous allons en avoir besoin.</p>
<p>Connectons nous à MySQL grâce à son client en ligne de commande :</p><pre>root@server:~# mysql<br />Welcome to the MySQL monitor. Commands end with ; or g.<br /><br />Server version: 5.1.49-3 (Debian)<br /> <br />Copyright (c) 2000, 2010, Oracle and/or its affiliates. All rights reserved.<br />This software comes with ABSOLUTELY NO WARRANTY. This is free software,<br />and you are welcome to modify and redistribute it under the GPL v2 license<br />Type 'help;' or 'h' for help. Type 'c' to clear the current input statement. <br />mysql></pre>
<p>Nous avon maintenant la possibilité d'entrer des requêtes SQL sans vérification de
  droits quelconques. A savoir, l'option --skip-grant-tables ne nous permet pas d'utiliser
  les requêtes de type GRANT. Nous allons donc devoir agir directement sur les tables
  virtuelles de MySQL. Pour changer le mot de passe :</p><pre>mysql> UPDATE mysql.user SET password=PASSWORD('nouveaumdp') WHERE User="root";</pre>
<p>Pour récupérer tous les privilèges :</p><pre>mysql> UPDATE mysql.user SET Grant_priv = 'Y', Super_priv = 'Y' WHERE User = 'root';</pre>
<p>On peut maintenant fermer le client mysql.</p><pre>mysql> exit<br />Bye</pre>
<p>Pour mettre fin au processus et redémarrer MySQL dans des conditions normales de
  production, il faut à nouveau tuer le processus mysqld grâce aux commandes utilisées
  plus haut et redémarrer le serveur :</p><pre>root@server:~# /etc/init.d/mysql restart</pre>
<p>Voilà. N'hésitez pas à donner vos trucs perso en commentaire.</p>