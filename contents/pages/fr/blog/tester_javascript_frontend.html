<!--VarStream
title=Tester son JavaScript front end
description=Depuis que j'ai découvert Karma, je ne me lasse plus de convertir mes projets pour lancer les tests grâce à cet outil. Retour d'expérience et conseils pour une utilisation pleine et entière.
shortTitle=Test JavaScript front
shortDesc=En savoir plus sur Karma et les tests automatisés
published=2013-08-25T13:24:22.000Z
lang=fr
location=FR
keywords.+=JavaScript
categories.+=.*
-->

<h2>Depuis que j'ai découvert Karma, je ne me lasse plus de convertir mes projets pour lancer les tests grâce à cet outil. Retour d'expérience et conseils pour une utilisation pleine et entière.</h2>
<p>Depuis que j'ai découvert Karma, je ne me lasse plus de convertir mes projets pour
  lancer les tests grâce à cet outil. Retour d'expérience et conseils pour une utilisation
  pleine et entière.</p>

<p><a>reflang=en title=Voir le dépôt de Karma href=https://github.com/karma-runner/]Karma Runner</a>  est un lanceur de tests automatisés. Sa particularité est qu'il gère tous les navigateurs
  de Firefox à Internet Explorer 6. Ce projet est issu et utilisé par l'équipe de
  développement d'AngularJS (un projet créé et soutenu par Google donc).</p>
<h3>Installer Karma</h3>
<p>Karma est un module pour NodeJS, il vous faudra donc installer Node en premier lieu.
  Une fois cela fait, il suffit d'installer le module NPM de karma pour pouvoir commencer :</p><pre>npm install -g karma</pre>
<p>Il vous faudra les droits administrateur pour exécuter cette commande car elle installe
  Karma de manière globale ce qui est recommandé pour l'utiliser sur tous vos projets
  sans réinstaller Karma à chaque fois.</p>
<p>L'installation de base de Karma est volontairement minimaliste. Vous devrez sûrement
  installer des modules complémentaires (plug-ins), comme les divers frameworks de
  tests et de chargement de modules AMD. Pour ma part, je vais tester la librairie
  Commandor qui se présente sous la forme d'un module UMD, je vais donc avoir besoin
  du plugin RequireJS :</p><pre>npm install -g karma-requirejs</pre>
<p>J'utilise le framework de test Mocha, il me faut donc aussi installer le plug-in
  correspondant :</p><pre>npm install -g karma-mocha</pre>
<p>Enfin, pour chaque navigateur que nous souhaitons tester, nous devons installer les
  lanceurs correspondants :</p><pre># Mozilla Firefox<br />npm install karma-firefox-launcher<br /># Google Chrome<br />npm install karma-chrome-launcher<br /># Internet Explorer<br />npm install karma-ie-launcher<br /># SlimerJS<br />npm install karma-slimerjs-launcher<br /># Pour voir la liste des lanceurs disponibles<br />npm search karma-launcher</pre>
<p>Nous voilà donc avec une installation complète de Karma Runner, il ne reste plus
  qu'à tester nos projets.</p>
<h3>Configurer les tests</h3>
<p>Pour configurer les tests d'un projet, vous avez deux solutions, utiliser l'initieur
  de projets qui vous pose toutes les questions nécessaires à la création de votre
  fichier karma.conf.json :</p><pre>karma init</pre>
<p>Ou alors, simplement, copier/coller le <a>reflang=en title=Voir le fichier de configuration de Commandor href=https://github.com/nfroidure/Commandor/blob/master/karma.conf.js]fichier d'un projet existant</a>.
  Typiquement, le fichier de configuration Karma est une simple déclaration des navigateurs
  que vous souhaitez tester et des plug-ins que vous souhaitez utiliser.</p>
<p>Les informations les plus importantes sont les fichiers que vous voulez servir et
  de quelle façon. En effet, lorsque vous lancez les tests, Karma lance un serveur
  Web/WebSocket et démarre vos divers navigateurs en leur indiquant l'adresse à charger.</p>
<h3>Lancer les tests</h3>
<p>Pour lancer les tests, il suffit de taper la commande suivante :</p><pre>karma start karma.conf.js<br />INFO [[karma]]: Karma v0.10.1 server started at http://localhost:9876/<br />INFO [[launcher]]: Starting browser Chrome<br />INFO [[launcher]]: Starting browser PhantomJS<br />INFO [[launcher]]: Starting browser SlimerJS<br />INFO [[launcher]]: Starting browser Firefox<br />INFO [[launcher]]: Starting browser Opera<br />INFO [[PhantomJS 1.9.1 (Linux)]]: Connected on socket id wNBBZ8YKbSMaZ0ZUhsKy<br />INFO [[Chrome 26.0.1410 (Linux)]]: Connected on socket id _CpwDOdv2x4SdfuRhsKz<br />INFO [[Other 0.0.0 (Linux)]]: Connected on socket id ik-BRxveU9jkhpzShsK0<br />INFO [[Opera 12.16.0 (Linux)]]: Connected on socket id NTmgHieffSR3ZXBshsK1<br />INFO [[Firefox 23.0.0 (Linux)]]: Connected on socket id _p-fNdQpNOLdeJClhsK2</pre>
<p>Dès lors, pour connecter un nouveau navigateur sans utiliser de lanceur, il suffit
  d'ouvrir l'adresse donnée par Karma dans ce dernier. Un exemple avec mon téléphone
  Android :</p><pre>INFO [[Chrome Mobile 28.0.1500 (Android 4.1.2)]]: Connected on socket id Iyi7l8bgnvIh1mjyhsK</pre>
<p>Pour chaque navigateur, un compte rendu des tests vous est alors présenté, si des
  tests échouent, alors les exceptions lancées sont affichées dans la console. C'est
  un peu le paradis des développeurs front-end :</p><pre>PhantomJS 1.9.1 (Linux): Executed 0 of 0 ERROR (0.025 secs / 0 secs)<br />Chrome 26.0.1410 (Linux): Executed 11 of 11 SUCCESS (0.078 secs / 0.017 secs)<br />Other 0.0.0 (Linux): Executed 11 of 11 SUCCESS (0.155 secs / 0.024 secs)<br />Opera 12.16.0 (Linux): Executed 11 of 11 (5 FAILED) (0.104 secs / NaN secs)<br />Firefox 23.0.0 (Linux): Executed 11 of 11 SUCCESS (0.135 secs / 0.015 secs)<br />Firefox Mobile 23.0.0 (Android): Executed 14 of 14 (3 FAILED) (1.042 secs / NaN secs)</pre>
<p>Vous pouvez voir qu'il me reste encore un peu de boulot à ce stade ;).</p>
<h3>Automatiser les tests avec Travis</h3>
<p>Mais ce n'est pas tout. Peut-être que vous connaissez Travis, un hook pour GitHub
  qui permet de lancer les tests à chaque commit dans une machine virtuelle. Les
  machines virtuelles de Travis embarquent PhantomJS et Firefox par défaut. Nous
  allons donc utiliser Firefox pour afficher un joli logo indiquant que les tests
  passent bien depuis le dernier commit.</p>
<p>Pour ce faire, il suffit de créer un fichier au format Travis nommé <a>reflang=en title=Voir le fichier Travis de Commandor href=https://github.com/nfroidure/Commandor/blob/master/.travis.yml].travis.yml</a>  et de l'ajouter à la racine de votre projet. Vous devrez aussi autoriser travis
  à accéder à votre gitHub. Voilà la petite image qui indique si Commandor passe
  les tests depuis le dernier commit :</p>
<p><img>lt=Image indiquant le statut des tests src=https://travis-ci.org/nfroidure/Commandor.png?branch=master
  /] </p>
<p>Je l'ai ajoutée au README du projet pour monter le sérieux de ce dernier. Et voilà,
  Travis vous enverra un mail dès que vos tests échouent pour vous avertir. Si quelqu'un
  fait un pull request, Travis testera pour vous si ce PR passe bien les tests. Elle
  est pas belle la vie ?</p>
<h3>Aller plus loin</h3>
<p>Sur le <a>itle=Se rednre sur le salon IRC de FranceJS href=irc://irc.freenode.org#francejs]salon IRC de FranceJS</a>  on est euphoriques avec Karma et chacun partage ses expériences et astuces pour
  l'utiliser. Erwan Mest a même promis qu'il ferait un billet sur le lancement de
  VM IE avec Travis (:p). N'hésitez donc pas à nous rejoindre !</p>
<p>De mon côté, j'ai bien envie de créer un lanceur pour FirefoxOS ce qui devrait être
  assez simple. J'ai créé un <a>reflang=en title=Voir le projet du lanceur href=https://github.com/nfroidure/karma-slimerjs-launcher]lanceur</a>  pour <a>reflang=en title=Voir le site de SlimerJS href=http://slimerjs.org]SlimerJS</a>  (un <a>reflang=en title=Voir le site de PhantomJS href=http://phantomjs.org]PhantomJS</a>  basé sur Gecko), mais je n'ai pas réussi à l'utiliser avec Travis.</p>
<p>Enfin, je suis en pleine réflexion sur la création d'un lanceur pour Android. J'ai
  trouvé quelques pistes comme l'outil de lancement de VM en ligne de commande (<a>reflang=en title=Voir l'outil href=http://developer.android.com/tools/help/emulator.html]emulator</a>)
  et l'outil de manipulation d'instances de l'émulateur (<a>itle=Voir l'outil href=http://developer.android.com/tools/help/monkeyrunner_concepts.html]monkey-runner</a>).
  Je pense qu'avec tout cela, il y a moyen de faire quelque chose, n'hésitez pas
  à me bipper si vous connaissez déjà un outil permettant de le faire.</p>